<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>{% block title %}{% endblock %} - {{ sitename }}</title>
    <meta name="HandheldFriendly" content="true" />
    <meta name="viewport" content="width=device-width, height=device-height, user-scalable=no" />
    <link rel="stylesheet" href="/css/bootstrap.css" type="text/css"/>
    <style>
        body {
            padding-top: 60px; /* Account for the navbar */
        }
        .chart {
            height: 200px;
        }

        /* The loading animation that appears in charts */
        div.chart div.bg_loading {
            background: url("/images/loading.gif") no-repeat center center;
            width: 100%;
            height: 100%;
        }

        .refreshbutton{
            float: right;
        }
    </style>
    <link rel="stylesheet" href="/css/bootstrap-responsive.css" type="text.css" />
    {% if ui and ui == 'm' -%}
        <style type="text/css">
            .dygraph-title {
                font-size: 10pt;
            }
            .dygraph-label {
                font-size: 10pt;
            }
        </style>
    {%- endif %}
    {% block head %} {% endblock %}
</head>
<body>
{#- ###################### Some macros ###################### -#}
{#- This Macro implements the Bootstrap breadcrumb component. Usage is:
      {{ breadcrumb([('/s/rua/','Home'), ('/s/rua/2012/','2012')],'April') }}
-#}
{%- macro breadcrumb(parents, this_page) %}
    {%- if this_page %}
    <ul class="breadcrumb">
    {%- if parents %}
        {%- for parent in parents %}
        <li>
            <a href="{{ parent[0] }}">{{ parent[1] }}</a> <span class="divider">/</span>
        </li>
        {%- endfor %}
    {%- endif %}
        <li class="active">{{ this_page }}</li>
    </ul>
    {%- endif %}
{%- endmacro -%}
{#- This macro outputs navbar list items and sets the active state based on
    if the href is '#' or './'
 -#}
{%- macro navli(id, name) -%}
    {% if nav[id] == "#" or nav[id] == "./" -%}
    <li class="active">
    {%- else -%}
    <li>
    {%- endif -%}
    <a href="{{ nav[id] }}">{{ name }}</a></li>
{%- endmacro %}

    {% if nav -%}
    <div class="navbar navbar-fixed-top">
        <div class="navbar-inner">
            <div class="container">
                <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </a>
                <a class="brand" href="#">{{ sitename }}</a>
                <div class="nav-collapse">
                    <ul class="nav">
                        {% if archive_mode %}
                        {{ navli('home', 'Home') }}
                        {% else %}
                        {{ navli('home','Now') }}
                        {{ navli('yesterday','Yesterday') }}
                        {{ navli('this_month','This Month') }}
                        {{ navli('this_year','This Year') }}
                        {% endif %}
                        {{ navli('about','About') }}
                    </ul>
                    {% if (page_data["stations"]|length) > 1 %}
                    <ul class="nav pull-right">
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">{{ page_data["station_name"] }}<b class="caret"></b></a>
                            <ul class="dropdown-menu">
                                {% for station in page_data["stations"] %}
                                <li><a href="{{ station[0] }}">{{ station[1] }}</a></li>
                                {% endfor %}
                            </ul>
                        </li>
                    </ul>
                    {% endif %}
                </div><!--/.nav-collapse -->
            </div>
        </div>
    </div>
    {%- endif %}

    <div class="container">
        {% if ui and ui == 'm' -%}
        <div class="alert alert-info">
            <button type="button" class="close" data-dismiss="alert">Ã—</button>
            <strong>Note!</strong> This is an experimental user interface that
            draws charts a bit differently. It is not finished and
            may malfunction or look odd. If you encounter any unusual behaviour
            you can go back to the <a id="std_ui_link" href="#">Standard UI</a>.
        </div>
        <script type="text/javascript">
            document.getElementById('std_ui_link').href = window.location.href.replace('/m/','/s/');
        </script>
        {%- endif -%}
        {%- block content %}{% endblock %}
    </div>

    {% if (page_data["stations"]|length) > 1 %}
    {# This dialog and associated script, etc, is used when switching to a
     # station that doesn't have data for what ever date you switched from. In
     # that case the user is given the option to navigate to a page the station
     # *does* have data for or to go back where they came from. As this is only
     # of any use when there are multiple stations present there isn't any point
     # in sending it to the browser when there is only one station present. #}
    <div id="ndModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h3>No Data: <span id="nd_station"></span></h3>
        </div>
        <div class="modal-body">
            <p>
                The weather station you selected does not have any data for
                <span id="nd_date"></span>. If you wish to browse
                data for that station you should select one of the links
                below as a starting point.
            </p>
            <p>
                The earliest date available for the station is:
                <a href="#" id="nd_earliest_lnk">none</a>.
            </p>
            <p>
                The latest date avaialble for the station is:
                <a href="#" id="nd_latest_lnk">none</a>.
            </p>
        </div>
        <div class="modal-footer">
            <a href="#" class="btn" data-dismiss="modal" aria-hidden="true">Close</a>
        </div>
    </div>
    <script type="text/javascript" src="/js/jquery.min.js"></script>
    <script type="text/javascript" src="/js/bootstrap.min.js"></script>
    {%- block scripts %}{% endblock %}
    <script type="text/javascript">
    function show_no_data(station_name, date, earliest_date, earliest_url, latest_date, latest_url) {
        $('#nd_station').html(station_name);
        $('#nd_date').html(date);

        var earliest_link = $('#nd_earliest_lnk');
        var latest_link = $('#nd_latest_lnk');
        earliest_link.attr('href', earliest_url);
        earliest_link.html(earliest_date);
        earliest_link.click(function() {
            $('#ndModal').modal('hide');
            return true;
        });

        latest_link.attr('href', latest_url);
        latest_link.attr('onclick', 'close_and_switch("' + latest_url + '");');
        latest_link.html(latest_date);
        latest_link.click(function() {
            $('#ndModal').modal('hide');
            return true;
        });

        $('#ndModal').modal();
    }
    </script>
    {% endif %}
</body>
</html>