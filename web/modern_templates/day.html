{# This template is for a daily overview. #}

{% extends "base.html" %}
{% block title %}Weather for {{ data.date_stamp }}{% endblock %}
{% block head %}{% endblock %}
{% block content %}
    <h1>Weather for {{ data.date_stamp }}</h1>
    <hr> {#  This is only shown when we are looking at todays weather. #}
    <div class="top-navlinks">
        {% if data.current_data %}<a href="#current">Current Conditions</a> |{% endif %}
        <a href="#records">Records</a> | 
        <a href="#1day">1-day charts</a> | 
        <a href="#7day">7-day charts</a>
    </div>


    <section>
    {% if data.current_data -%}
        <div class="row">
            <div class="span6">
                <h2 id="current">Conditions as of <span id="current_time">{{ data.current_data_ts }}</span></h2>
                <div id="current_conditions">
                    <table  class="table table-bordered">
                        <thead>
                        <tr>
                            <th>Sensor</th>
                            <th>Value</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td>Relative Humidity</td>
                            <td>{{ data.current_data.relative_humidity }}%</td>
                        </tr>
                        <tr>
                            <td>Temperature</td>
                            <td>{{ data.current_data.temperature|round(1) }}°C</td>
                        </tr>
                        <tr>
                            <td>Apparent Temperature</td>
                            <td>{{ data.current_data.apparent_temperature|round(1) }}°C</td>
                        </tr>
                        <tr>
                            <td>Wind Chill</td>
                            <td>{{ data.current_data.wind_chill|round(1) }}°C</td>
                        </tr>
                        <tr>
                            <td>Dew Point</td>
                            <td>{{ data.current_data.dew_point|round(1) }}°C</td>
                        </tr>
                        <tr>
                            <td>Absolute Pressure</td>
                            <td>{{ data.current_data.absolute_pressure|round(1) }} hPa</td>
                        </tr>
                        <tr>
                            <td>Average Wind Speed</td>
                            <td>{{ data.current_data.average_wind_speed|round(1) }} m/s</td>
                        </tr>
                        <tr>
                            <td>Gust Wind Speed</td>
                            <td>{{ data.current_data.gust_wind_speed|round(1) }} m/s</td>
                        </tr>
                        <tr>
                            <td>Wind Direction</td>
                            <td>{{ data.current_data.wind_direction }}</td>
                        </tr> {#
                        <tr>
                            <td>Rainfall</td>
                            <td>{{ data.current_data.rainfall|round(1) }} mm</td>
                        </tr> #}
                        </tbody>
                    </table>
                </div>
                <div id="cc_stale" style="display: none;">
                    <div class="alert alert-error">
                        <strong>Error:</strong>
                        No live data available. Live data
                        has not been refreshed in <span id="cc_data_age"></span> seconds.
                        The update service has likely stopped.
                    </div>
                </div>
                <div id="cc_refresh_failed" style="display: none;">
                    <div class="alert alert-warning">
                        <strong>Warning!</strong>
                        Live data refresh failed. The server may be down.
                    </div>
                </div>
            </div>
            <div class="span6">
    {%- else -%}
        <div class="row"><div class="span6">
    {%- endif %}
            <h2 id="records">Records{% if data.current_data %}<button id="btn_records_refresh" class="btn refreshbutton" onclick="refresh_records()" data-loading-text="loading..."><i class="icon-refresh"></i> Refresh</button>{% endif %}</h2>
            <div id="records_table">
                <table  class="table table-bordered">
                    <thead>
                    <tr>
                        <th>Sensor</th>
                        <th>Min</th>
                        <th>Max</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>Temperature</td>
                        <td id="temp_min">{{ data.records.min_temperature|round(1) }}°C at {{ data.records.min_temperature_ts }}</td>
                        <td id="temp_max">{{ data.records.max_temperature|round(1) }}°C at {{ data.records.max_temperature_ts }}</td>
                    </tr>
                    <tr>
                        <td>Wind Chill</td>
                        <td id="wc_min">{{ data.records.min_wind_chill|round(1) }}°C at {{ data.records.min_wind_chill_ts }}</td>
                        <td id="wc_max">{{ data.records.max_wind_chill|round(1) }}°C at {{ data.records.max_wind_chill_ts }}</td>
                    </tr>
                    <tr>
                        <td>Apparent Temperature</td>
                        <td id="at_min">{{ data.records.min_apparent_temperature|round(1) }}°C at {{ data.records.min_apparent_temperature_ts }}</td>
                        <td id="at_max">{{ data.records.max_apparent_temperature|round(1) }}°C at {{ data.records.max_apparent_temperature_ts }}</td>
                    </tr>
                    <tr>
                        <td>Dew Point</td>
                        <td id="dp_min">{{ data.records.min_dew_point|round(1) }}°C at {{ data.records.min_dew_point_ts }}</td>
                        <td id="dp_max">{{ data.records.max_dew_point|round(1) }}°C at {{ data.records.max_dew_point_ts }}</td>
                    </tr>
                    <tr>
                        <td>Absolute Pressure</td>
                        <td id="ap_min">{{ data.records.min_absolute_pressure|round(1) }} hPa at {{ data.records.min_absolute_pressure_ts }}</td>
                        <td id="ap_max">{{ data.records.max_absolute_pressure|round(1) }} hPa at {{ data.records.max_absolute_pressure_ts }}</td>
                    </tr>
                    <tr>
                        <td>Relative Humidity</td>
                        <td id="rh_min">{{ data.records.min_humidity }}% at {{ data.records.min_humidity_ts }}</td>
                        <td id="rh_max">{{ data.records.max_humidity }}% at {{ data.records.max_humidity_ts }}</td>
                    </tr>
                    <tr>
                        <td>Gust Wind Speed</td>
                        <td class="no-value"></td>
                        <td id="gws">{{ data.records.max_gust_wind_speed|round(1) }} m/s at {{ data.records.max_gust_wind_speed_ts }}</td>
                    </tr>
                    <tr>
                        <td>Average Wind Speed</td>
                        <td class="no-value"></td>
                        <td id="aws">{{ data.records.max_average_wind_speed|round(1) }} m/s at {{ data.records.max_average_wind_speed_ts }}</td>
                    </tr>
                    </tbody>
                </table>
                <p>Total Rainfall: <span id="tot_rainfall">{{ data.records.total_rainfall|round(1) }}</span>mm</p>
            </div>
            <div id="rec_refresh_failed" style="display: none;">
                <div class="alert alert-warning">
                    <strong>Warning!</strong>
                    Loading records failed. The server may be down.
                </div>
            </div>
    {% if data.current_data -%}
            </div>
        </div>
    {%- else -%}
        </div><div class="span6"></div></div>
    {%- endif %}
    </section>

    <section id="1day">
    <h2>1-day Charts{% if data.current_data %}<button id="btn_today_refresh" class="btn refreshbutton" onclick="refresh_day_charts()" data-loading-text="loading..."><i class="icon-refresh"></i> Refresh</button>{% endif %}</h2>
        <div id="day_charts_cont">
            <div class="row">
                <div class="span6">
                    <div id="chart_temperature_tdp_div" class="chart">
                        <img src="/images/loading.gif" alt="loading"/>
                    </div>
                </div>
                <div class="span6">
                    <div id="chart_temperature_awc_div" class="chart">
                        <img src="/images/loading.gif" alt="loading"/>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="span6">
                    <div id="chart_humidity_div" class="chart">
                        <img src="/images/loading.gif" alt="loading"/>
                    </div>
                </div>
                <div class="span6">
                    <div id="chart_pressure_div" class="chart">
                        <img src="/images/loading.gif" alt="loading"/>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="span6">
                    <div id="chart_hourly_rainfall_div" class="chart">
                        <img src="/images/loading.gif" alt="loading"/>
                    </div>
                </div>
                <div class="span6">

                </div>
            </div>
        </div>
        <div id="lc_refresh_failed" style="display: none;">
            <div class="alert alert-warning">
                <strong>Warning!</strong>
                Failed to load charts. The server may be down.
            </div>
        </div>
    </section>

    <section id="7day">
        <h2>7-day Charts{% if data.current_data %}<button id="btn_7day_refresh" class="btn refreshbutton" onclick="refresh_7day_charts()" data-loading-text="loading..."><i class="icon-refresh"></i> Refresh</button>{% endif %}</h2>
        <div id="7day-charts">
            <div id="chart_7_temperature_tdp_div" class="chart">
                <img src="/images/loading.gif" alt="loading"/>
            </div>
            <div id="chart_7_temperature_awc_div" class="chart">
                <img src="/images/loading.gif" alt="loading"/>
            </div>
            <div id="chart_7_humidity_div" class="chart">
                <img src="/images/loading.gif" alt="loading"/>
            </div>
            <div id="chart_7_pressure_div" class="chart">
                <img src="/images/loading.gif" alt="loading"/>
            </div>
            <div id="chart_7_hourly_rainfall_div" class="chart">
                <img src="/images/loading.gif" alt="loading"/>
            </div>
        </div>
        <div id="lc7_refresh_failed" style="display: none;">
            <div class="alert alert-warning">
                <strong>Warning!</strong>
                Failed to load charts. The server may be down.
            </div>
        </div>
    </section>

    <hr>
    <div class="footer-navlinks">
    {% if data.prev_url %}
        <a href="{{ data.prev_url }}">&lt;&lt; {{ data.prev_date }}</a>
    {% else %}
        {{ data.prev_date }}
    {% endif %}
    |
    <a href="../">{{ data.this_month }}</a>
    |
    {% if data.next_url %}
        <a href="{{ data.next_url }}">{{ data.next_date }} &gt;&gt;</a>
    {% else %}
        {{ data.next_date }}
    {% endif %}
    <br>
    <a href="../../../now">Today</a>
    </div>
    <a href="indoor.html">I</a>

    <script type="text/javascript" src="../../../../../js/jquery.min.js"></script>
    <script type="text/javascript" src="http://www.google.com/jsapi"></script>
    <script type="text/javascript">
        // URLs required by day.js
        var live_url = '../../../../../data/{{ station }}/live.json';
        var samples_url = '{{ data_urls['samples']}}';
        var rainfall_url = '{{ data_urls['rainfall'] }}';
        var samples_7day_url = '{{ data_urls['7day_samples'] }}';
        var rainfall_7day_url = '{{ data_urls['7day_rainfall'] }}';
        var records_url = '{{ data_urls['records'] }}';
        var rainfall_totals_url = '{{ data_urls['rainfall_totals'] }}';
        var live_auto_refresh;
        {% if data.current_data -%}
        live_auto_refresh = true;
        {%- else -%}
        live_auto_refresh = false;
        {%- endif %}
    </script>
    <script type="text/javascript" src="../../../../../js/day.js"></script>
{% endblock %}